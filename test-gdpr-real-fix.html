<!DOCTYPE html>
<html>
<head>
    <title>üõ°Ô∏è TEST GDPR COMPLIANCE - VERIFICA REALE</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #f5f5f5; }
        .test-section { background: white; padding: 20px; margin: 15px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .prompt { background: #e3f2fd; padding: 10px; border-left: 4px solid #2196f3; margin: 10px 0; }
        .result { background: #f1f8e9; padding: 10px; border-left: 4px solid #4caf50; margin: 10px 0; }
        .field { margin: 5px 0; padding: 8px; background: #fff; border: 1px solid #ddd; border-radius: 4px; }
        .required { font-weight: bold; color: #d32f2f; }
        .checkbox-field { background: #fff3e0; border-left: 3px solid #ff9800; }
        button { background: #2196f3; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; margin: 10px 5px; }
        button:hover { background: #1976d2; }
        .success { color: #4caf50; font-weight: bold; }
        .error { color: #f44336; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è TEST GDPR COMPLIANCE - VERIFICA CHE FUNZIONI DAVVERO</h1>
    
    <div class="test-section">
        <h2>Test 1: Prompt con parole chiave GDPR</h2>
        <div class="prompt"><strong>Prompt:</strong> "Crea un form contatto per newsletter marketing e privacy policy"</div>
        <button onclick="testGDPR1()">üß™ Testa GDPR Detection</button>
        <div id="result1" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Prompt normale (no GDPR)</h2>
        <div class="prompt"><strong>Prompt:</strong> "Crea un form contatto semplice per azienda web"</div>
        <button onclick="testNormal()">üß™ Testa Normale</button>
        <div id="result2" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Prompt GDPR specifico (quello che hai provato)</h2>
        <div class="prompt"><strong>Prompt:</strong> "form contatto per gdpr compliance con consenso privacy"</div>
        <button onclick="testGDPRSpecific()">üß™ Testa GDPR Specifico</button>
        <div id="result3" class="result" style="display:none;"></div>
    </div>

    <script>
        const API_URL = 'https://qjtaqrlpronohgpfdxsi.supabase.co/functions/v1/generate-form-fields';

        async function testPrompt(prompt, resultDiv) {
            const resultElement = document.getElementById(resultDiv);
            resultElement.style.display = 'block';
            resultElement.innerHTML = '<p>‚è≥ Testing...</p>';
            
            try {
                console.log(`üß™ Testing prompt: "${prompt}"`);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqdGFxcmxwcm9ub2hncGZkeHNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ2ODk0NDYsImV4cCI6MjA1MDI2NTQ0Nn0.4_KlkqOo9qhZ4RyGbNlSgf8DTJXKM7wBGhpfhkOJHSE'
                    },
                    body: JSON.stringify({ prompt })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('‚úÖ Response:', data);
                
                let html = '<h3 class="success">‚úÖ RISULTATO:</h3>';
                
                if (data.fields && Array.isArray(data.fields)) {
                    data.fields.forEach(field => {
                        const isRequired = field.required ? ' (Required)' : ' (Optional)';
                        const cssClass = field.type === 'checkbox' ? 'field checkbox-field' : 'field';
                        const requiredClass = field.required ? 'required' : '';
                        
                        html += `<div class="${cssClass}">
                            <strong>${field.name}</strong>: ${field.label} 
                            <span class="${requiredClass}">[${field.type}${isRequired}]</span>
                        </div>`;
                    });
                    
                    // Check for GDPR compliance
                    const hasPrivacyConsent = data.fields.some(f => f.name === 'privacy_consent');
                    const hasMarketingConsent = data.fields.some(f => f.name === 'marketing_consent');
                    
                    if (hasPrivacyConsent || hasMarketingConsent) {
                        html += `<div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border: 2px solid #4caf50; border-radius: 4px;">
                            <strong>üõ°Ô∏è GDPR COMPLIANCE DETECTED:</strong><br>
                            ${hasPrivacyConsent ? '‚úÖ Privacy Consent Field' : '‚ùå No Privacy Consent'}<br>
                            ${hasMarketingConsent ? '‚úÖ Marketing Consent Field' : '‚ùå No Marketing Consent'}
                        </div>`;
                    } else {
                        html += `<div style="margin-top: 15px; padding: 10px; background: #fff3e0; border: 2px solid #ff9800; border-radius: 4px;">
                            <strong>‚ö†Ô∏è NO GDPR FIELDS DETECTED</strong><br>
                            Standard form without compliance fields
                        </div>`;
                    }
                } else {
                    html += '<p class="error">‚ùå Invalid response format</p>';
                }
                
                resultElement.innerHTML = html;
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                resultElement.innerHTML = `<p class="error">‚ùå ERROR: ${error.message}</p>`;
            }
        }

        function testGDPR1() {
            testPrompt("Crea un form contatto per newsletter marketing e privacy policy", "result1");
        }

        function testNormal() {
            testPrompt("Crea un form contatto semplice per azienda web", "result2");
        }

        function testGDPRSpecific() {
            testPrompt("form contatto per gdpr compliance con consenso privacy", "result3");
        }
    </script>
</body>
</html>